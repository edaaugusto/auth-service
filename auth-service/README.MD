# üöÄ Servi√ßo de Autentica√ß√£o (`auth-service`) - Ecossistema Projeta√≠

Este microservi√ßo √© a autoridade central de identidade para o ecossistema **Projeta√≠**. Ele √© respons√°vel por gerenciar o ciclo de vida de autentica√ß√£o (registro, login) e autoriza√ß√£o via tokens JWT (JSON Web Token).

O servi√ßo foi projetado para ser **stateless** (sem sess√£o no servidor) e facilmente integr√°vel com diferentes front-ends (Web, Mobile) e outros microservi√ßos.

---

## üõ†Ô∏è Tecnologias Principais

* **Java 17** (LTS)
* **Spring Boot 3.x**
* **Spring Security 6** (Autentica√ß√£o e Criptografia BCrypt)
* **JWT (Auth0 java-jwt)** (Gera√ß√£o e Valida√ß√£o de Tokens)
* **Spring Data JPA & Hibernate** (Persist√™ncia)
* **MySQL Driver**

---

## ‚ö° Guia de In√≠cio R√°pido (Desenvolvimento Local)

Siga estes passos para rodar o projeto na sua m√°quina pela primeira vez.

### 1. Pr√©-requisitos
* Java 17 instalado.
* MySQL rodando localmente.
* Maven (opcional, se usar o wrapper `./mvnw`).

### 2. Configura√ß√£o do Banco Local
Crie um banco de dados vazio para desenvolvimento:
```sql
CREATE DATABASE projeteidb;
3. Configura√ß√£o de Credenciais
O projeto n√£o possui senhas comitadas. Crie ou edite o arquivo src/main/resources/application.properties com suas credenciais locais:

Properties

# --- Configura√ß√£o Local (DEV) ---
server.port=8080
spring.datasource.url=jdbc:mysql://localhost:3306/projeteidb
spring.datasource.username=SEU_USER_LOCAL  # ex: root
spring.datasource.password=SUA_SENHA_LOCAL # ex: 123456

# Em DEV, 'update' cria as tabelas automaticamente. NUNCA usar em produ√ß√£o.
spring.jpa.hibernate.ddl-auto=update

# Chave para assinar tokens (use qualquer string longa para testes locais)
api.jwt.secret=CHAVE_SECRETA_DESENVOLVIMENTO_123
4. Executar
Rode a classe principal AuthServiceApplication.java via IDE ou terminal:

Bash

./mvnw spring-boot:run

üîå Guia de Integra√ß√£o (Produ√ß√£o / Projeto Raiz)
ATEN√á√ÉO EQUIPE: Ao integrar este servi√ßo ao ambiente oficial do Projeta√≠, as seguintes configura√ß√µes s√£o OBRIGAT√ìRIAS.

1. Conex√£o com Banco de Dados Existente (Legado)
O projeto raiz j√° possui banco de dados. Para evitar perda de dados ou altera√ß√µes indesejadas no esquema oficial:

REGRA DE OURO: No application.properties de produ√ß√£o, a configura√ß√£o DEVE ser:

Properties

# 'validate' apenas checa se a tabela existe, mas N√ÉO altera nada.
spring.jpa.hibernate.ddl-auto=validate
Mapeamento de Tabela: Se a tabela de usu√°rios no banco raiz tiver outro nome (ex: TB_USUARIO_SISTEMA em vez de users), N√ÉO altere o c√≥digo Java. Use anota√ß√µes na classe model/User.java:

Java

@Entity
@Table(name = "TB_USUARIO_SISTEMA") // Nome real no banco legado
public class User implements UserDetails {
    @Column(name = "DS_EMAIL_LOGIN") // Nome real da coluna
    private String email;
    // ...
}


2. Integra√ß√£o com Front-end (CORS)
Para que o Front-end (React, Angular, Vue, etc.) consiga fazer requisi√ß√µes para este servi√ßo, √© necess√°rio liberar a origem dele no CORS.

V√° at√© a classe config/SecurityConfig.java.

Localize o m√©todo corsConfigurationSource().

Adicione a URL de produ√ß√£o do front-end √† lista de origens permitidas:

Java

configuration.setAllowedOrigins(List.of(
    "http://localhost:3000",      // Front em Dev local
    "http://localhost:5500",      // Front em Dev local (alternativo)
    "[https://www.projetai.com.br](https://www.projetai.com.br)" // URL OFICIAL DE PRODU√á√ÉO DO FRONT (Adicionar)
));
3. Vari√°veis de Ambiente (Seguran√ßa)
Em produ√ß√£o, N√ÉO coloque senhas reais no application.properties. Utilize vari√°veis de ambiente do servidor ou do container (Docker):

DB_HOST: URL do banco de produ√ß√£o.

DB_USER: Usu√°rio do banco.

DB_PASS: Senha do banco.

JWT_SECRET: A chave mestra real (deve ser longa, complexa e mantida em segredo absoluto).

üîë Documenta√ß√£o da API (Endpoints)
1. Registrar Novo Usu√°rio
Cria um novo login no sistema.

URL: POST /api/auth/register

Body (JSON):

JSON

{
  "email": "novo.usuario@projetai.com",
  "password": "senhaSegura123"
}
Respostas:

201 Created: Sucesso.

400 Bad Request: Email j√° existente ou dados inv√°lidos.

2. Login (Autentica√ß√£o)
Verifica credenciais e retorna o token de acesso.

URL: POST /api/auth/login

Body (JSON):

JSON

{
  "email": "usuario@projetai.com",
  "password": "senhaSegura123"
}
Resposta de Sucesso (200 OK):

JSON

{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expiresIn": 3600
}
Uso do Token: Nas requisi√ß√µes para outros servi√ßos, envie o header: Authorization: Bearer <seu_token_aqui>